
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Graphia Pointcloud</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
<script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
<script src="https://unpkg.com/@loaders.gl/3d-tiles@2.3.7/dist/dist.min.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>
<script>
var taxparcel = {"type": "FeatureCollection", "features": [{ "type": "Feature", "properties": { "PARCEL": "022", "APN": "48018022" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -120.930484, 38.192545, 0.0 ], [ -120.931398, 38.192614, 0.0 ], [ -120.931671, 38.192544, 0.0 ], [ -120.933326, 38.192514, 0.0 ], [ -120.93467, 38.192507, 0.0 ], [ -120.935972, 38.19254, 0.0 ], [ -120.936354, 38.192531, 0.0 ], [ -120.936273, 38.191151, 0.0 ], [ -120.936261, 38.190561, 0.0 ], [ -120.936256, 38.190425, 0.0 ], [ -120.936242, 38.189999, 0.0 ], [ -120.936222, 38.189552, 0.0 ], [ -120.936193, 38.188957, 0.0 ], [ -120.931493, 38.189124, 0.0 ], [ -120.931383, 38.187467, 0.0 ], [ -120.931369, 38.187297, 0.0 ], [ -120.931324, 38.186649, 0.0 ], [ -120.926589, 38.186879, 0.0 ], [ -120.926741, 38.188273, 0.0 ], [ -120.9268, 38.189031, 0.0 ], [ -120.927135, 38.192573, 0.0 ], [ -120.927437, 38.192584, 0.0 ], [ -120.928512, 38.192567, 0.0 ], [ -120.929363, 38.192554, 0.0 ], [ -120.930484, 38.192545, 0.0 ] ] ] } } ] };
var bbox = turf.bbox(taxparcel);
var center = turf.centerOfMass(taxparcel);
var start = center.geometry;
var bounds = [
[bbox[0], bbox[1]],
[bbox[2], bbox[3]]
];
  
const ION_ASSET_ID = 1466958;
const ION_TOKEN ='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJmMzk0ZGRmOS05NTAzLTRmZTMtOTZiZi00ZWQ4NjRmOGQxOTQiLCJpZCI6MTE5NjMyLCJpYXQiOjE2NzIxNzUzMTZ9._k9f5aMW7jICbP3RDUqapx2oAyyUx2jRb0glcJliZRA';
const TILESET_URL = `https://assets.cesium.com/${ION_ASSET_ID}/tileset.json`;
const {MapboxLayer,Tile3DLayer} = deck;
const {CesiumIonLoader} = loaders;
const myDeckLayer = new MapboxLayer({
  id: '3DTiles',
  type: Tile3DLayer,
  data: TILESET_URL,
  loader: CesiumIonLoader,
  loadOptions: {'cesium-ion': {accessToken: ION_TOKEN}},
onTilesetLoad: tileset => {
        const {cartographicCenter, zoom} = tileset;
        const lng = cartographicCenter[0];
        const lat = cartographicCenter[1];
}});

mapboxgl.accessToken = 'pk.eyJ1IjoiZ3JhcGhpYWxsYyIsImEiOiJjbGJ6czdmczQxMG96M25tbjdtcHAzMXZsIn0.W51THNVZ1hqjky2typW9xg';
const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-v9',
        center: [center.geometry.coordinates[0],center.geometry.coordinates[1]],
        bounds: bounds,
        pitch: 0,
        interactive: true,
        projection: "equirectangular",
        customAttribution: 'Graphia LLC'
    });

map.addControl(new mapboxgl.NavigationControl());

map.once('load', () => { 

  map.addLayer(myDeckLayer);
  
  map.fitBounds(bbox,{padding:40});

  map.setFog({});

  map.addSource('mapbox-dem', {
  'type': 'raster-dem',
  'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
  'tileSize': 512,
  'maxzoom': 14
  });

  map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1 });
});
  
map.on('moveend', () => {
});
</script>

</body>
</html>
